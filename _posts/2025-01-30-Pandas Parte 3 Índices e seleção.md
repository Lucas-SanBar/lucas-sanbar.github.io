---
title: "Desbravando o Pandas - Parte 3 - √çndices e sele√ß√£o"
description: Continuando com Pandas, desta vez mostrando o b√°sico de √çndices e como seleciona-los.
date: 2025-01-30
categories: [Python, Pandas]
tags: [jupyter notebook, manipula√ß√£o de dados, engenharia de dados]
image: 
  path: /assets/images/30-01-2025/Capa-30-01-2025.png 
---

Neste documento continuaremos explorarando os conceitos iniciais da biblioteca Pandas. Para acompanhamento utilizaremos a mesma base do [üîóDesbravando o Pandas - Parte 1 - Estrutura de dados](https://lucas-sanbar.github.io/posts/Pandas-Parte-1-Estrutura-de-Dados/) e seguirei com as mesmas estruturas criadas previamente.

---

## √çndices

Toda estrutura do tipo DataFrame possui √≠ndices, os √≠ndices no pandas s√£o essenciais para organizar e acessar dados dentro de um DataFrame ou Series. Eles funcionam como identificadores √∫nicos para as linhas, facilitando buscas, filtragens e opera√ß√µes avan√ßadas.

Existem tr√™s tipos de √≠ndices, sendo eles: 
* √çndices n√∫mericos.
* √çndices textuais(Labels).
* √çndices multi-n√≠vel(MultiIndex).

### DataFrame com √≠ndices n√∫mericos

Normalmente os √≠ndices s√£o do tipo **n√∫merico** por padr√£o, do valor **0** ao **n√∫mero de linhas do DataFrame - 1**, mas tamb√©m pode ser do tipo **textual(r√≥tuos/labels)**.

```python
df_data
```

![Bloco 1](/assets/images/30-01-2025/Bloco 1.png)
_√çndices criado por padr√£o no DataFrame `df_data`_

Observe que o √≠ndice do DataFrame `df_data` n√£o possui uma coluna especifica para ele. Para recuperar o index no Pandas, basta utilizar o m√©todo `index`:

```python
df_data.index
```

![Bloco 2](/assets/images/30-01-2025/Bloco 2.png)
_√çndices no DataFrame `df_data`, com √≠nicio no 0 e fim em 105018_

### DataFrame com √≠ndices textuais (Labels)

Um **√≠ndice textual** no pandas √© quando usamos valores de texto (strings) como √≠ndice em um DataFrame ou Series. Isso facilita buscas e manipula√ß√µes, tornando os dados mais leg√≠veis e organizados.

```python
satisfacao_labels = pd.DataFrame({
    'bom': [50,21,100],
    'ruim': [131,2,30],
    'pessimo': [30,20,1]
}, index = ['Ford','volkswagen', 'BMW'])

satisfacao_labels
```

![Bloco 3](/assets/images/30-01-2025/Bloco 3.png)
_Retorno do DataFrame criado `satisfacao_labels`, com √≠nd√≠ce textual_

```python
satisfacao_labels.index
```
![Bloco 4](/assets/images/30-01-2025/Bloco 4.png)
_√çndices no DataFrame `satisfacao_labels`, contendo **'Ford'**, **'volkswagen'** e **'BMW'**_

### DataFrame com √≠ndices multi-n√≠vel (MultiIndex)

O MultiIndex no pandas permite criar √≠ndices hier√°rquicos, ou seja, um √≠ndice composto por m√∫ltiplas colunas. Isso √© √∫til para organizar e acessar dados estruturados de forma mais eficiente.

Podemos definir m√∫ltiplas colunas como √≠ndice usando `set_index()`:

```python
MultiIndex = pd.DataFrame({
    'categoria': ['A', 'A', 'B', 'B'],
    'produto': ['P1', 'P2', 'P1', 'P2'],
    'vendas': [100, 150, 200, 250]
})

MultiIndex.set_index(['categoria', 'produto'], inplace=True)

MultiIndex
```

![Bloco 5](/assets/images/30-01-2025/Bloco 5.png)
_Retorno do DataFrame `MultiIndex` com √≠ndice multi-n√≠vel_

```python
MultiIndex.index
```

![Bloco 6](/assets/images/30-01-2025/Bloco 6.png)
_√çndices no DataFrame `MultiIndex`, contendo dois √≠ndices, **categoria** e **produto**_

Para resetar o √≠ndex ao padr√£o original, basta usar `MultiIndex.reset_index(inplace=True)`

---

## Sele√ß√£o de √çndex

A sele√ß√£o de √≠ndice nos permite acessar, organizar e manipular os dados de um DataFrame. O √≠ndice funciona como um identificador √∫nico para as linhas, possibilitando assim buscas r√°pidas, segmenta√ß√£o e opera√ß√µes estruturadas.

### Sele√ß√£o baseada em √≠ndices

Para mostrar linhas especificas de um DataFrame, usa-se:

`iloc` : Seleciona elementos de um DataFrame, baseando-se em **√≠ndices n√∫mericos**

#### Selecionando uma amostra/linha

```python
df_data.iloc[1] ## Extra√≠ndo a linha com o √≠ndice 1
```

![Bloco 7](/assets/images/30-01-2025/Bloco 7.png)
_√çndice 1 no DataFrame `df_data`_

```python
df_data.iloc[1,6] ## Extra√≠ndo a linha com √≠ndice 1 e coluna 6 (Faixa Et√°ria)
```

![Bloco 8](/assets/images/30-01-2025/Bloco 8.png)
_√çndice 1 e coluna 6 no DataFrame `df_data`_

#### Selecionando **m√∫ltiplas** amostras/linhas

Uma das formas de se fazer isso √© utilizando **slicing**, passando um intervalo dos nossos valores

```python
df_data.iloc[:3] ## Extra√≠ndo as linhas com √≠ndice >= 0 e <= 2
```

![Bloco 9](/assets/images/30-01-2025/Bloco 9.png)
_Retorno da extra√ß√£o das linhas 0,1 e 2 do DataFrame `df_data`_

```python
df_data.iloc[10:13] ## Extra√≠ndo as linhas com √≠ndice >= 10 e <= 12
```

![Bloco 10](/assets/images/30-01-2025/Bloco 10.png)
_Retorno da extra√ß√£o das linhas 10,11 e 12 do DataFrame `df_data`_

```python
df_data.iloc[1,5,10] ## Extra√≠ndo as linhas com √≠ndice 1,5 e 10
```

![Bloco 11](/assets/images/30-01-2025/Bloco 11.png)
_Retorno da extra√ß√£o das linhas 1,5 e 10 do DataFrame `df_data`_

### Sele√ß√£o baseada em label

Para seleccionar elementos do DataFrame pelo seu **r√≥tulo/label** usa se:

`loc` : Seleciona elementos de um DataFrame, baseando-se em **r√≥tulo**.

```python
satisfacao_labels.loc['Ford'] ## Retorna a linha cujo o r√≥tulo do √≠ndice √© 'Ford'
```

![Bloco 12](/assets/images/30-01-2025/Bloco 12.png)
_Retorno da extra√ß√£o do label 'Ford' do DataFrame `satisfacao_labels`_

Semelhante ao `iloc` podemos selecionar linha e coluna baseando no label

```python
satisfacao_labels.loc['Ford','ruim']
```

![Bloco 13](/assets/images/30-01-2025/Bloco 13.png)
_Retorno da extra√ß√£o do label 'Ford' da coluna 'ruim' do DataFrame `satisfacao_labels`_

Se quisermos buscar apenas as colunas **'ruim'** e **'pessimo'** do DataFrame `satisfacao_labels`, existem duas possibilidades:

```python
## Forma 1:
satisfacao_labels[['ruim','pessimo']] ## Retorna todas as linhas do DataFrame mas apenas as colunas 'ruim' e 'pessimo'
```

![Bloco 14](/assets/images/30-01-2025/Bloco 14.png)
_Retorno da extra√ß√£o de todas as linhas e apenas as colunas 'ruim' e 'pessimo' do DataFrame `satisfacao_labels`_

```python
## Forma 2
satisfacao_labels.loc[:,['ruim','pessimo']] ## Retorna os √≠ndices 0 a n-1 (:) mas apenas as colunas 'ruim' e 'pessimo'
```

![Bloco 15](/assets/images/30-01-2025/Bloco 15.png)
_Retorno da extra√ß√£o de todas as linhas e apenas as colunas 'ruim' e 'pessimo' do DataFrame `satisfacao_labels`_

Mesmo em DataFrame com √≠ndices baseados em r√≥tulos, √© poss√≠vel a utiliza√ß√£o do `iloc` para selecionar elementos baseando-se em seu √≠ndice impl√≠cito, por exemplo, se quisermos seleccionar a linha 2 do DataFrame `satisfacao_labels` basta:

```python
satisfacao_labels.iloc[2] ## Retorna a linha de √≠ndice 2 (BMW) do DataFrame
```

![Bloco 16](/assets/images/30-01-2025/Bloco 16.png)
_Retorno da extra√ß√£o da linha de √≠ndice 2 (BMW)do DataFrame satisfacao_labels_

>√çndices n√∫meros, por default, possuem r√≥tulos que correspondem aos seus valores n√∫mericos. Ou seja, √© poss√≠vel usar o `iloc` e `loc` para √≠ndices n√∫mericos.
{: .prompt-tip }

#### Sele√ß√£o de uma ou mais colunas

J√° vimos que para selecionar uma coluna de um DataFrame(`df_data`) basta utilizar `df_data['Cidade']` , `df_data.Cidade` (Este, apenas para casos com colunas sem caracteres especiais e sem espa√ßo) ou `data.loc[:, 'Cidade']` .

Para retorno de mais de uma coluna √© necess√°rio passar uma lista **['Colune 1','Coluna 2','Coluna 3', '...']**

```python
df_data[['Cidade','UF','Regi√£o']] ## Retorna a coluna 'Cidade', 'UF' e 'Regi√£o'
```

![Bloco 17](/assets/images/30-01-2025/Bloco 17.png)
_Retorno da extra√ß√£o de todas as linha das colunas 'Cidade', 'UF' e 'Regi√£o'_

### Sele√ß√£o de √≠ndices MultiIndex

Para identificar os n√≠veis do √≠ndex do tipo MultiIndex, utilizaremos o m√©todo `index.levels`

```python
MultiIndex
```

![Bloco 18](/assets/images/30-01-2025/Bloco 18.png)
_Retorno do DataFrame `MultiIndex`_

```python
MultiIndex.index.levels
```

![Bloco 19](/assets/images/30-01-2025/Bloco 19.png)
_Retorno dos n√≠veis do DataFrame `MultiIndex`_

Para identificar os valores do n√≠vel 1 e 2 respectivamente, usamos o m√©todo `get_level_values(n)`, com **n** sendo o level do √≠ndice.

```python
MultiIndex.index.get_level_values(0)  ## Retorna os valores do primeiro n√≠vel Categoria
```

![Bloco 20](/assets/images/30-01-2025/Bloco 20.png)
_Retorno dos n√≠vel de **Categoria** do DataFrame `MultiIndex`_

```python
MultiIndex.index.get_level_values(1)  ## Retorna os valores do segundo n√≠vel Produto
```

![Bloco 21](/assets/images/30-01-2025/Bloco 21.png)
_Retorno dos n√≠vel de **Produto** do DataFrame `MultiIndex`_

Para extrair informa√ß√µes de √≠ndices MultiIndex devemos passar os n √≠ndices requeridos atrav√©s do m√©todo `loc`

```python
MultiIndex.loc[('A', 'P1')]  ## Retorna o valor referente ao √≠ndice 1 (Categoria) textual 'A' e ao √≠ndice 2 (Produto) textual 'P1'
```

![Bloco 22](/assets/images/30-01-2025/Bloco 22.png)
_Retorno da busca referente ao √≠ndice 1 (Categoria) textual 'A' e ao √≠ndice 2 (Produto) textual 'P1' do DataFrame `MultiIndex`_

```python
MultiIndex.loc[(['A', 'B'], ['P1']), :] ## Retorna o valor referente ao √≠ndice 1 (Categoria) textual 'A' e 'B' e ao √≠ndice 2 (Produto) textual 'P1'
```

![Bloco 23](/assets/images/30-01-2025/Bloco 23.png)
_Retorno referente ao √≠ndice 1 (Categoria) textual 'A' e 'B' e ao √≠ndice 2 (Produto) textual 'P1 do DataFrame `MultiIndex`_

1. `(['A', 'B'], ['P1'])` :
   * O primeiro n√≠vel (categoria) recebe uma lista ['A', 'B'], garantindo que ambas sejam selecionadas.
   * O segundo n√≠vel (produto) tamb√©m recebe uma lista ['P1'], garantindo que apenas P1 seja selecionado.
2. Adi√ß√£o de `:` (dois pontos) :
   * Necess√°rio para indicar que queremos todas as colunas.

---

## Resumo dos m√©todos

|       M√©todo       |                Descri√ß√£o                 |
| :----------------: | :--------------------------------------: |
|       .index       |         Retornar o objeto √≠ndice         |
| .set_index(coluna) |      Define uma coluna como √≠ndice       |
|   .reset_index()   | Remove o √≠ndice e transforma-o em coluna |
|    .loc[indice]    |    Acessa dados pelo valor do √≠ndice     |
|   .iloc[posi√ß√£o]   |    Acessa dados pela posi√ß√£o num√©rica    |
|   .sort_index()    |      Ordena o DataFrame pelo √≠ndice      |
| .droplevel(n√≠vel)  | Remove um n√≠vel de um √≠ndice multi-n√≠vel |

---

>Para download do notebook utilizado, acesse o [üîóLink](https://github.com/Lucas-SanBar/PyArq/blob/a7003fc5268c42739287e548fb104e7af59702e2/Desbravando%20Pandas/Parte%203%20-%20%C3%8Dndices%20e%20sele%C3%A7%C3%A3o.ipynb)
{: .prompt-warning }


