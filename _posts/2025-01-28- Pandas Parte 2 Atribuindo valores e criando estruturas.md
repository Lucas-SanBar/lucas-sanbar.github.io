---
title: "Desbravando o Pandas - Parte 2 - Atribuindo valores e criando atributos"
description: A continua√ß√£o da explor√ß√£o da biblioteca Pandas, desta vez mostrando como atribuir valores e como criar atributos.
date: 2025-01-28
categories: [Python, Pandas]
tags: [jupyter notebook, manipula√ß√£o de dados, engenharia de dados]
image: 
  path: /assets/images/28-01-2025/Capa-28-01-2025.png 
---

Neste documento continuaremos explorarando os conceitos iniciais da biblioteca Pandas. Para acompanhamento utilizaremos a mesma base do [üîóDesbravando o Pandas - Parte 1 - Estrutura de dados](https://lucas-sanbar.github.io/posts/Pandas-Parte-1-Estrutura-de-Dados/) e seguirei com as mesmas estruturas criadas previamente.

---

## Atribuindo Dados

Atribuir dados significa modificar ou adicionar valores em um DataFrame ou Series. A forma como a atribui√ß√£o √© feita pode ter impactos significativos no comportamento, como criar c√≥pias ou refer√™ncias, alterar os dados originais ou gerar erros. Abaixo est√£o os principais conceitos e pr√°ticas.

### Atribuindo Constantes

Ao fazermos uma atribui√ß√£o de uma coluna de um DataFrame, como por exemplo a coluna `Cidade` no DataFrame `df_data`

```python
df_data['Cidade']
```

![Bloco 1](/assets/images/28-01-2025/Bloco 1.png)
_Valores da coluna **Cidade** do DataFrame `df_data`_

Podemos fazer a atribui√ß√£o de valores de duas formas, **C√ìPIA** e **REFER√äNCIA/VIEW**. Para isso:

```python
cidade_copy = df_data['Cidade'].copy() #C√≥pia da coluna Cidade
cidade_copy
```

![Bloco 2](/assets/images/28-01-2025/Bloco 2.png)
_Valores da coluna **Cidade** copiados para a vari√°vel `cidade_copy`_

```python
cidade_view = df_data['Cidade'] #Refer√™ncia/View da coluna Cidade
cidade_view
```

![Bloco 3](/assets/images/28-01-2025/Bloco 3.png)
_Valores da coluna **Cidade** referenciados para a vari√°vel `cidade_view`_

E qual a diferen√ßa entre **REFER√äNCIA/VIEW** e **C√ìPIA**?
Caso alguma altera√ß√£o no DataFrame original `df_data` seja feita, temos que:

Para exemplificar utilizando a fun√ß√£o `iloc`, esta nos permite selecionar linhas e colunas no DataFrame com base em uma posi√ß√£o n√∫merica, vamos alterar ent√£o a **LINHA 0** e **COLUNA 4**, para isso podemos fazer da seguinte forma:

```python
df_data.iloc[0,4] = 'Alterado' #Alterando o DataFrame original no √≠ndice 0 e coluna 4 para 'Alterado'
df_data.head(1) #Retornando apenas o primeiro √≠ndice
```
![Bloco 4](/assets/images/28-01-2025/Bloco 4.png)
_Valores do √çndice 0 e coluna 4 alterado_

Ap√≥s a altera√ß√£o, se buscarmos a **C√ìPIA** teremos o seguinte:

```python
cidade_copy
```
![Bloco 5](/assets/images/28-01-2025/Bloco 5.png)
_Valores da vari√°vel `cidade_copy` ap√≥s altera√ß√£o_

Ap√≥s a altera√ß√£o, se buscarmos a **REFER√äNCIA/VIEW** teremos o seguinte:

```python
cidade_view
```
![Bloco 6](/assets/images/28-01-2025/Bloco 6.png)
_Valores da vari√°vel `cidade_view` ap√≥s altera√ß√£o_

Nota-se ent√£o, que os valores da **C√ìPIA** se mant√©m mesmo ap√≥s a altera√ß√£o do DataFrame original `df_data`, enquanto a **REFER√äNCIA** por ser um ponteiro ao DataFrame original tamb√©m tem seu valor alterado.

A escolha entre view (refer√™ncia direta) e c√≥pia (duplica√ß√£o dos dados) no pandas depende do contexto em que voc√™ est√° trabalhando e dos objetivos da opera√ß√£o. Cada abordagem tem vantagens e desvantagens e deve ser usada com cuidado para evitar comportamentos inesperados ou problemas de desempenho.

Quando utilizar **Refer√™ncia/View**?

Uma view √© √∫til quando voc√™ quer manipular ou visualizar dados diretamente no DataFrame original sem duplic√°-los na mem√≥ria.

Casos comuns:
* Quando voc√™ deseja modificar valores existentes no DataFrame original.
* Quando voc√™ busca efici√™ncia de mem√≥ria, j√° que n√£o existe a necessidade de duplicar estruturas.
* Usar views √© eficiente para acessar partes de um DataFrame que voc√™ deseja processar ou analisar diretamente.
* Evitar duplica√ß√£o acidental.

Quando utilizar **C√≥pia**?

Uma c√≥pia cria um novo objeto com dados independentes, √∫til quando voc√™ precisa trabalhar com dados isolados do DataFrame original.

Casos comuns:
* Se voc√™ deseja processar ou transformar os dados sem impactar o DataFrame original.
* Evitar efeitos colaterais inesperados.
* Comparar antes e depois de alguma altera√ß√£o.
* Isolamento de processamento paralelo (Em pipelines de dados ou processos paralelos, criar c√≥pias ajuda a evitar conflitos entre threads ou fun√ß√µes).
* Usar uma c√≥pia garante que mudan√ßas feitas por terceiros n√£o afetem sua an√°lise.

Boas pr√°ticas

1. **Garanta a Inten√ß√£o**: Use .copy() explicitamente se n√£o quiser modificar o DataFrame original.
2. **Evite Substitui√ß√µes Desnecess√°rias**: Modifique valores in-place usando .loc ou .iloc quando poss√≠vel.
3. **Leia Warnings**: O SettingWithCopyWarning avisa quando o pandas detecta opera√ß√µes amb√≠guas entre views e c√≥pias.

| Situa√ß√£o                                          | Use View | Use C√≥pia |
| ------------------------------------------------- | -------- | --------- |
| Modificar dados direto no DataFrame               | ‚úîÔ∏è Sim    | ‚ùå N√£o     |
| Manter dados originais intactos                   | ‚ùå N√£o    | ‚úîÔ∏è Sim     |
| Evitar uso excessivo de mem√≥ria                   | ‚úîÔ∏è Sim    | ‚ùå N√£o     |
| Comparar dados antes e depois de alguma altera√ß√£o | ‚ùå N√£o    | ‚úîÔ∏è Sim     |
| Trabalhar em subconjunto tempor√°rio               | ‚úîÔ∏è Sim    | ‚ùå N√£o     |
| Isolamento entre processos e threads              | ‚ùå N√£o    | ‚úîÔ∏è Sim     |

### Atribuindo Listas ou Series

O nosso DataFram `df_data` cont√©m **105018 linhas** e **30 colunas**, para fazer a altera√ß√£o de uma coluna inteira precisamos de uma **Series** contendo o mesmo n√∫mero de linhas existente na coluna objetivo ou seja, uma lista contendo 105018

```python
n_linhas, n_colum = df_data.shape
n_linhas, n_colum
```

![Bloco 7](/assets/images/28-01-2025/Bloco 7.png)
_Resultado da execu√ß√£o `df_data.shape`, com a dimens√£o do DataFrame criado `df_data`, contendo 105018 linhas e 30 colunas_

Para cria√ß√£o destes 105018 valores de uma coluna utilizaremos **LIST COMPREHENSION**, que √© uma forma de criar listas a partir de outras listas, usando uma nota√ß√£o matem√°tica.

```python
novas_cidades = [f'Cidade {i}'for i in range(n_linhas)]
len(novas_cidades) #Retorna o n√∫mero de itens de um objeto, como uma lista, string, tupla, dicion√°rio ou qualquer sequ√™ncia
```

![Bloco 8](/assets/images/28-01-2025/Bloco 8.png)
_Quantidade de valores ap√≥s cria√ß√£o da lista `novas_cidades`_

>A lista `novas_cidades` recebe um looping de 0 at√© o n√∫mero de linhas do DataFrame `df_data`, onde cada passagem a string **'Cidade '** √© concatenado com o valor do √≠ndice da passagem **i**
{: .prompt-tip }

A quantidade de elementos na lista `novas_cidades` √© igual ao n√∫mero de linhas do DataFrame `df_data`, podemos ent√£o fazer a substitui√ß√£o dos valores da coluna Cidade para o novo valor.

```python
df_data['Cidade'] = novas_cidades #Substituindo os valores da coluna Cidade pelos valores da lista novas_cidades
df_data.head()
```

![Bloco 9](/assets/images/28-01-2025/Bloco 9.png)
_Valores trocados ap√≥s altera√ß√£o para `novas_cidades`_

Para retornarmos os dados de **Cidade** originais, podemos utilizar a c√≥pia feita na Series `cidade_copy`, esta Series foi criada e copiada antes da altera√ß√£o da coluna, portanto tem os valores originais da mesma.

```python
df_data['Cidade'] = cidade_copy #Retornando os valores originais da coluna Cidade utilizando a c√≥pia feita antes da altera√ß√£o
df_data.head()
```

![Bloco 10](/assets/images/28-01-2025/Bloco 10.png)
_Valores retornados para o origal utilizando a c√≥pia feita em `cidade_copy`_

---

## Criando novas colunas

No pandas, criar novas colunas em um DataFrame √© uma tarefa comum, essencial para enriquecer os dados com informa√ß√µes derivadas, categoriza√ß√µes ou transforma√ß√µes. Essa opera√ß√£o √© direta, mas oferece muitas possibilidades.

Para se criar uma nova coluna em um DataFrame √© necess√°rio atribuirmos uma lista/Series de valores ou uma constante a uma nova chave do DataFrame. Da mesmo forma da atribui√ß√£o, a quantidade de valores da lista precisa ser igual ao n√∫mero de linhas totais do DataFrame.

### Criando colunas a partir de valores constantes

Para criar colunas a partir de um valor constante, ou seja, todas as linhas ter√£o o mesmo valor para esta nova coluna podemos:

```python
df_data['Coluna Constante'] = 'Valor Constante'
df_data.head(3)
```

![Bloco 11](/assets/images/28-01-2025/Bloco 11.png)
_Retorno do `df_data` ap√≥s a cria√ß√£o da nova coluna `Coluna Constante`_

Agora, a nova coluna `Coluna Constante` foi criada e ela cont√©m em todas as 105018 linhas o mesmo valor, neste caso a string **'Constante'**.

### Criando colunas a partir de uma lista

Para criar colunas a partir de uma lista pr√© definida, basta atribuir ao DataFrame o novo campo com a lista.

```python
df_data['Coluna Lista'] = range(df_data.shape[0])
df_data.head(3)
```

![Bloco 12](/assets/images/28-01-2025/Bloco 12.png)
_Retorno do `df_data` ap√≥s a cria√ß√£o da nova coluna `Coluna Lista`_

Agora, a nova coluna `Coluna Lista` foi criada e ela cont√©m em todas as 105018, neste caso o intervalo entre n√∫mero **0** at√© **105017**.

### Criando colunas a partir de uma lista menor

Se tentarmos atribuir uma lista menor do que a quantidade de linhas totais do DataFrame teremos um problema de Match. Exemplo, se tentarmos atribuir uma lista de 3 itens no DataFrame `df_data`:

```python
df_data['Lista Menor'] = [1,2,3]
```

![Bloco 13](/assets/images/28-01-2025/Bloco 13.png)
_Erro retornado ap√≥s a tentativa de cria√ß√£o da nova coluna `Lista Menor`_

### Criando colunas a partir de outras colunas

Uma coluna pode ser criado com base em calculos matem√°tios e/ou condicionais dependentes de outros campos. Por exemplo, se tentarmos criar uma nova coluna chamada `Nova Nota Consumidor` onde o valor dela √© a multiplica√ß√£o do campo `Nota Consumidor` * **2**, fariamos o seguintes:

```python
df_data['Nova Nota do Consumidor'] = df_data['Nota do Consumidor'] * 2
df_data.head(3)
```

![Bloco 14](/assets/images/28-01-2025/Bloco 14.png)
_Retorno do `df_data` ap√≥s a cria√ß√£o da nova coluna `Nova Nota do Consumidor`_

### Criando colunas condicionais

Uma coluna pode ser criado com base em condicionais dependentes de outros campos. Por exemplo, se tentarmos criar uma nova coluna chamada `Coluna Condicional` onde o valor dela √© dependente do valor do campo `Nova Nota do Consumidor` sendo que, caso este seja maior ou igual a 5 retorna **'Boa'** caso contr√°rio **Ruim**:

```python
df_data['Coluna Condicional'] = np.where(df_data['Nova Nota do Consumidor'] >= 5, 'Boa','Ruim')
df_data.head(3)
```

>Neste caso precisamos utilizar a biblioteca `numpy` na qual ser√° tratada posteriormente
{: .prompt-tip }

![Bloco 15](/assets/images/28-01-2025/Bloco 15.png)
_Retorno do `df_data` ap√≥s a cria√ß√£o da nova coluna `Coluna Condicional`_

### Dropando campos

Para fazer o drop de campos que n√£o ser√£o utilizados no DataFrame, basta utilizar o m√©todo `drop()`, da seguinte forma:

```python
df_data.drop(['Coluna Constante','Coluna Lista','Nova Nota do Consumidor'], axis=1, inplace=True) 
df_data.head(3)
## O atributo axis(0|1) serve para indicarmos se a exclus√£o sera coluna ou linha
## O Atributo inplace(True|False) serve para descartar a necessidade de cria√ß√£o de um novo DataFrame
```

![Bloco 16](/assets/images/28-01-2025/Bloco 16.png)
_Retorno do `df_data` ap√≥s a remo√ß√£o das novas colunas `Coluna Constante`, `Coluna Lista` e `Nova Nota do Consumidor`_

Quais as vantagens de se dropar campos de um DataFrame?
* **Flexibilidade** : Funciona tanto para remover linhas quanto colunas, com uma sintaxe consistente.
* **Controle sobre modifica√ß√µes** : Com `inplace=False` (padr√£o), mant√©m o DataFrame original intacto, retornando uma nova c√≥pia com as altera√ß√µes.
* **Limpeza de dados** : Facilita a remo√ß√£o de dados indesejados ou irrelevantes, ideal para remo√ß√£o de colunas redundantes ou outliers.
* **Evita problemas de inconsist√™ncia** : Ajuda a evitar falhas em pipelines de dados.

---

>Para download do notebook utilizado, acesse o [üîóLink](https://github.com/Lucas-SanBar/PyArq/blob/2aa31d0d6ee760a2b32280e11c1fc3f908c3b431/Desbravando%20Pandas/Parte%202%20-%20Atribuindo%20valores%20e%20criando%20atributos.ipynb)
{: .prompt-warning }
